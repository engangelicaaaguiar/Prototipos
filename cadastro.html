<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Angel Telemed — Seus dados</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
<div class="app">
  <div class="topbar">
    <img src="assets/img/icon-back.svg" class="back" onclick="history.back()">
    <div class="title">Seus dados de cadastro</div>
  </div>

  <div class="main">
    <h1>Atualize seus dados</h1>
    <p class="lead">Confirme e atualize seus dados para ativar sua conta.</p>

    <label for="nome">Nome completo</label>
    <input id="nome" type="text" placeholder="Seu nome completo" class="input">
    <div id="err-nome" class="helper">Digite nome e sobrenome.</div>

    <label for="cpf">CPF</label>
    <input id="cpf" type="text" class="input" readonly>

    <label for="nasc">Data de nascimento</label>
    <input id="nasc" type="text" placeholder="DD/MM/AAAA" class="input" maxlength="10">
    <div id="err-nasc" class="helper">Informe uma data válida (DD/MM/AAAA).</div>

    <label for="phone">Telefone celular</label>
    <input id="phone" type="text" placeholder="(99) 99999-9999" class="input">
    <div id="err-phone" class="helper">Telefone inválido. Use: (99) 99999-9999</div>

    <label for="email">E-mail (opcional)</label>
    <input id="email" type="email" placeholder="voce@email.com" class="input">
    <div id="err-email" class="helper">E-mail inválido.</div>

    <button id="btn-next" class="btn btn-primary" disabled>Continuar</button>
  </div>
</div>

<script type="module">
  import {
    maskCPF, cpfIsValid,
    maskPhone, phoneIsValid,
    maskDate, dateIsValid
  } from './assets/js/app.js';

  const nome = document.getElementById('nome');
  const cpf = document.getElementById('cpf');
  const nasc = document.getElementById('nasc');
  const phone = document.getElementById('phone');
  const email = document.getElementById('email');
  const btn = document.getElementById('btn-next');

  // Carregar CPF salvo na tela anterior
  cpf.value = localStorage.getItem('angel.cpf') || '';

  const reNome = /^[A-Za-zÀ-ÿ]{2,}\s+[A-Za-zÀ-ÿ]{2,}(\s+[A-Za-zÀ-ÿ]{2,})*$/;

  function validate() {
    // Nome completo (mín. 2 palavras)
    const nomeOK = reNome.test(nome.value.trim());
    document.getElementById('err-nome').classList.toggle('show', !nomeOK);

    // Data
    nasc.value = maskDate(nasc.value);
    const nascOK = dateIsValid(nasc.value);
    document.getElementById('err-nasc').classList.toggle('show', !nascOK);

    // Telefone
    phone.value = maskPhone(phone.value);
    const phoneOK = phoneIsValid(phone.value);
    document.getElementById('err-phone').classList.toggle('show', !phoneOK);

    // Email opcional
    const emailOK = email.value === '' || /\S+@\S+\.\S+/.test(email.value);
    document.getElementById('err-email').classList.toggle('show', !emailOK);

    btn.disabled = !(nomeOK && nascOK && phoneOK && emailOK);
  }

  nome.addEventListener('input', validate);
  nasc.addEventListener('input', validate);
  phone.addEventListener('input', validate);
  email.addEventListener('input', validate);

  btn.addEventListener('click', () => {
    if (btn.disabled) return;

    localStorage.setItem('angel.nome', nome.value.trim());
    localStorage.setItem('angel.nasc', nasc.value);
    localStorage.setItem('angel.phone', phone.value);
    localStorage.setItem('angel.email', email.value);

    console.log('onboarding_profile_submit', {valid: true});

    location.href = 'otp.html';
  });

  console.log('onboarding_profile_view');
</script>
</body>
</html>
