<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Angel Telemed — Seus dados de cadastro</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
<div class="app">
  <div class="topbar">
    <img src="assets/img/icon-back.svg" class="back" alt="Voltar" onclick="history.back()">
    <div class="title">Seus dados de cadastro</div>
  </div>
  <div class="main">
    <p class="lead">Confirme e atualize seus dados para ativar sua conta.</p>

    <label>Nome completo</label>
    <input id="nome" class="input" placeholder="Seu nome completo">

    <label style="margin-top:14px">CPF</label>
    <input id="cpf" class="input" readonly>

    <label style="margin-top:14px">Data de nascimento</label>
    <input id="nasc" class="input" placeholder="DD/MM/AAAA">

    <label style="margin-top:14px">Telefone</label>
    <input id="tel" class="input" placeholder="(99) 99999-9999">
    <div id="tel-err" class="helper">Não conseguimos validar este número. Confira o DDD e se é celular.</div>

    <div class="muted" style="margin-top:10px">Usaremos seu telefone apenas para validar o acesso.</div>

    <button id="go" class="btn btn-primary" disabled>Continuar</button>
  </div>
</div>

<script type="module">
  import {maskCPF,maskDate,maskPhone} from './assets/js/app.js';

  const nome=$('#nome'), cpf=$('#cpf'), nasc=$('#nasc'), tel=$('#tel'), go=$('#go'), err=$('#tel-err');

  // Prefill (mock)
  cpf.value = (localStorage.getItem('angel.cpf')||'').toString();
  nome.value = 'Ana Maria da Silva';
  nasc.value = '05/11/1970';
  tel.value  = '(48) 99999-9999';

  function validate(){
    tel.value = maskPhone(tel.value);
    nasc.value = maskDate(nasc.value);
    const ok = nome.value.trim().length>=3 && nasc.value.length===10 && /\(\d{2}\)\s\d{5}-\d{4}/.test(tel.value);
    err.classList.toggle('show', !/\(\d{2}\)\s\d{5}-\d{4}/.test(tel.value) && tel.value.length>0);
    go.disabled = !ok;
  }
  [nome,nasc,tel].forEach(i=>i.addEventListener('input', validate));
  validate();

  go.addEventListener('click', ()=>{
    console.log('onboarding_profile_submit',{valid: !go.disabled});
    if(go.disabled) return;
    localStorage.setItem('angel.phone', tel.value);
    location.href='otp.html';
  });

  console.log('onboarding_profile_view');
  console.log('onboarding_profile_prefill',{fields_prefilled:['nome','data','telefone']});
</script>
</body>
</html>

