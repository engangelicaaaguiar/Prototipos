<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Angel Telemed — Primeiro acesso</title>
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
<div class="app">
  <div class="topbar">
    <img src="assets/img/icon-back.svg" alt="Voltar" class="back" onclick="history.back()">
    <div class="title">Primeiro acesso</div>
  </div>

  <div class="main">
    <div class="welcome">
      <img src="assets/img/icon-welcome.svg" alt="" width="28" height="28">
      <h1>Boas-vindas!</h1>
    </div>
    <p class="lead">Para sua segurança e acesso ao seu prontuário, confirme o CPF cadastrado.</p>

    <label for="cpf">CPF</label>
    <input id="cpf" class="input" type="text" placeholder="000.000.000-00" aria-label="Digite seu CPF">
    <div id="cpf-err" class="helper">CPF inválido. Confira os números.</div>

    <div class="row" style="margin-top:14px">
      <input id="optin" type="checkbox" aria-label="Opt-in de comunicados">
      <div class="muted">Quero receber avisos e novidades por WhatsApp/E-mail.</div>
    </div>

    <div class="row" style="margin:10px 0 0">
      <a id="open-lgpd" href="#" class="muted">Seus dados são protegidos pela LGPD</a>
      <div style="flex:1"></div>
      <a href="https://wa.me/5500000000000" class="muted">Precisa de ajuda?</a>
    </div>

    <button id="btn-next" class="btn btn-primary" disabled>Continuar</button>
  </div>
</div>

<!-- Modal LGPD -->
<div id="lgpd-bg" class="modal-bg">
  <div class="modal">
    <span id="lgpd-close" class="close">×</span>
    <h3>Como usamos seus dados (LGPD)</h3>
    <p>Coletamos CPF para validar elegibilidade e proteger seu acesso. Base legal: execução de contrato e legítimo interesse (Art. 7º). Você pode revogar consentimentos de marketing a qualquer momento.</p>
    <p><a href="#" target="_blank">Ler política completa</a></p>
  </div>
</div>

<script type="module">
  import {maskCPF, cpfIsValid, bindLgpdModal} from './assets/js/app.js';

  const cpf = document.getElementById('cpf');
  const err = document.getElementById('cpf-err');
  const next = document.getElementById('btn-next');
  const optin = document.getElementById('optin');

  cpf.addEventListener('input', ()=>{
    cpf.value = maskCPF(cpf.value);
    const ok = cpf.value.replace(/\D/g,'').length===11 && cpfIsValid(cpf.value);
    next.disabled = !ok;
    err.classList.toggle('show', !ok && cpf.value.length>=14);
    window.localStorage.setItem('angel.cpf', cpf.value);
    console.log('onboarding_cpf_input', {chars_count: cpf.value.length, mask_ok: ok});
  });

  optin.addEventListener('change', ()=> console.log('marketing_optin_toggle',{on: optin.checked}));

  next.addEventListener('click', ()=>{
    const ok = cpfIsValid(cpf.value);
    console.log('onboarding_cpf_submit',{valid: ok});
    if(!ok){ err.classList.add('show'); return; }
    // simulação de elegibilidade: se começar com 999 → não encontrado
    if(cpf.value.startsWith('999')) location.href='cpf-nao.html';
    else location.href='cadastro.html';
  });

  bindLgpdModal();
  console.log('onboarding_cpf_view');
</script>
</body>
</html>

